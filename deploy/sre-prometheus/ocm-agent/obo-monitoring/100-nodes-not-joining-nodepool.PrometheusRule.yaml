---
apiVersion: monitoring.rhobs/v1
kind: PrometheusRule
metadata:
  labels:
    prometheus: nodepool-provisioning-failure
    role: alert-rules
  name: nodepool-provisioning-failure
  namespace: openshift-observability-rhobs
spec:
  groups:
    - name: NodePoolProvisioningFailureSRE
      interval: 60s
      rules:
        - alert: NodesNotJoiningNodePoolSRE
          annotations:
            description: "The NodePool {{ $labels.name }} has not reached its target size for more than 1 hour"
            summary: "NodePool provisioning Failure"
          expr: sum by (_id, namespace, cluster_name, exported_namespace, name) (((hypershift_nodepools_available_replicas / hypershift_nodepools_size) < 1) unless on (_id) ((hypershift_nodepools_size == 0) or hypershift_cluster_alerts_disabled))
          for: 60m
          labels:
            severity: warning
            send_managed_notification: "false"
            managed_notification_template: nodepool-provisioning-failure
            namespace: "{{ $labels.namespace }}"

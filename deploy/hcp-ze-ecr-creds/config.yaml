# ECR Credential Refresh for Zero-Egress HCP Clusters
#
# OHSS-49424: The global-pull-secret-syncer bug was backported to
# OCP 4.18+ where it overwrites kubelet ECR credentials.
# This CronJob refreshes additional-pull-secret every 4 hours
# so HCCO can merge it into global-pull-secret.
#
# The script auto-detects zero-egress clusters by checking for IDMS.
# Non-zero-egress clusters will exit early with success (no-op).
#
# SOP: https://github.com/openshift/ops-sop/blob/master/hypershift/knowledge_base/howto/zero-egress-ecr-credential-refresh.md
deploymentMode: Policy
clusterSelectors:
  matchExpressions:
    - key: hypershift.open-cluster-management.io/hosted-cluster
      operator: In
      values:
        - "true"
    - key: openshiftVersion-major-minor
      operator: NotIn
      values:
        - "4.14"
        - "4.15"
        - "4.16"
        - "4.17"
policy:
  destination: "acm-policies"
  complianceType: "mustonlyhave"
